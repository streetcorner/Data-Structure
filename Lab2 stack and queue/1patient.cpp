/*----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File name:1patient.cpp

Last modify:2016.10.8
Copyright(c) 2016 Wang Yumeng
All rights reserved.
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

#include <iostream>
#include <stdio.h>
#include <cstdlib>
using namespace std;

#define  MAXSIZE 1000 //  最大队列长度
typedef struct QNode{ //链队列结点的类型定义
    char  data[MAXSIZE];  //用于存放队列元素
    struct QNode *next;  //用于存放元素直接后继
                                    //结点的地址
}QNode,*QueuePtr;
typedef struct
{  //链队列的表头结点的的类型定义
    QueuePtr front;  //队头指针，指向链表的头结点
    QueuePtr rear;   //队尾指针，指向队尾结点
}LinkQueue;

//with head node
int InitQueue_L(LinkQueue &Q) {//建一个空队列
    Q.front=Q.rear=(QueuePtr)malloc(sizeof(QNode));
    //为链队列的头结点分配空间
    if (!Q.front) exit(1);
    Q.front->next=NULL;
    return 1;
} //InitQueue_L

//带头结点
int DestroyQueue_Lha(LinkQueue &Q)  {           //销毁队列Q
    if (!Q.front) return 0; // 链队列不存在
    QNode * p;
        while(Q.front->next) {   // 回收链队列的所有元素结点空间
            p=Q.front->next;
            Q.front->next=p->next;
            free(p);
        }
        free(Q.front );                       // 回收链队列头结点空间
        Q.front=Q.rear=NULL;
        return 1;
}//DestroyQueue_L

int  QueueUp(LinkQueue &Q) {     //在链队列Q队尾，插入新的队尾结点
    printf("请输入病历号和姓名：\n");

    QueuePtr p=(QueuePtr)malloc(sizeof(QNode));   //为新元素e分配结点空间
    if (!p) exit (1);     //存储分配失败
    scanf("%s",p->data);
    p->next=NULL;
    Q.rear->next=p;    //修改队尾指针，插入新队尾结点
    Q.rear=p;
    return 1;
}

void VisitDoc(LinkQueue &Q){ //dequeue
    printf("\n下一个病人为：\n");
    if (Q.front ==Q.rear) exit (1);
             //若队列空，返回ERROR
    QueuePtr p=Q.front->next;             // p指向队头元素结点
    cout<<p->data<<endl;
    //rintf("eeee\n");
    Q.front->next=p->next; // 修改链队列头结点指针
    if(Q.rear == p)  Q.rear=Q.front;
// 对于链队列只有一个元素结点的情况,要同时修改队尾指针
    free(p);
}
void display(LinkQueue &q){
    printf("\n当前所有排队的病人如下：\n");
    QueuePtr p=q.front->next;
    while(p!=NULL){
        cout<<p->data<<endl;
        p=p->next;
    }
    printf("\n");
}

int main(){
    LinkQueue q;
    InitQueue_L(q);//with head node
    int f=1,i;
    while(f){
        printf("\n请输入你想进行的操作的序号：\n1、排队\n2、就诊\n3、查看队列\n4、不再排队，余下依次就诊\n5、下班\n");
        cin>>i;
        if(i==1)
            QueueUp(q);
        if(i==2)
            VisitDoc(q);
        if(i==3)
            display(q);
        if(i==4){
            display(q);
            DestroyQueue_Lha(q);
            f=0;
        }
        if(i==5){
            DestroyQueue_Lha(q);
            f=0;
        }
    }

}
